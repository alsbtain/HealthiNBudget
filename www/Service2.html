<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<meta name="format-detection" content="telephone=no" />
<meta name="msapplication-tap-highlight" content="no" />
<meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi" />
<link rel="stylesheet" type="text/css" href="css/style.css" />
<script type="text/javascript" src="cordova.js"></script>
<script type="text/javascript" src="js/main.js"></script>
<script type="text/javascript" src="js/index.js"></script>
<script type="text/javascript" src="js/formulas.js"></script>
<script type="text/javascript" src="js/papaparse.js"></script>
<title>HealthiNBudget</title>
</head>
<body onload="showkcal();CSVReady();">
<h1>HealthiNBudget</h1>
<p><a href="index.html">index</a></p>
<p>You need to have <span id="kcal"></span> Cal more today.</p>
<form>
<p id="searchBox"></p>
</form>
<p id="results"></p>
<script>
var calmore;
function showkcal(){
	calmore = parseInt(localStorage.getItem('kcal'));
	if(calmore<0){
		calmore = 0;
	}
	document.getElementById('kcal').innerHTML = calmore;
}

function subtractkcal(kcal){
	localStorage.setItem('kcal', (calmore - kcal));
}

var CSVData;
function CSVReady(){
	Papa.parse('data/home.csv', {
		download: true,
		header: true,
		complete: function(results) {
			CSVData = results.data;
			document.getElementById('searchBox').innerHTML = '<input type="text" name="search" oninput="doSearch(this.value);" />';
		}
	});
}

function doSearch(word){
result = '';
	if(word.length>1){
		for(var i=0; i < (CSVData.length-1); i++){
			if(CSVData[i].Description.toLowerCase().search(word.toLowerCase()) > -1){
				result += 'Meal: ' + CSVData[i].Description + '<br />';
				result += 'Measure: ' + CSVData[i].Measure + '<br />';
				result += 'Energy: ' + CSVData[i].Energy + ' kcal/measure<br />';
				result += '<input type = "button" value = "I\'ll eat this!" onclick="subtractkcal(' + CSVData[i].Energy + '); showkcal();" /><br /><br />';
			}
		}
	}else{
		result = '';
	}
document.getElementById('results').innerHTML = result;
}
</script>
</body>
</html>